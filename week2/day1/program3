<!DOCTYPE html>
<html>
<head>
    <title>Expense Tracker - IndexedDB</title>
</head>
<body>

<h2>Mini Expense Tracker</h2>

<input type="text" id="title" placeholder="Expense Title">
<input type="number" id="amount" placeholder="Amount">
<input type="date" id="date">
<br><br>

<button onclick="addExpense()">Add Expense</button>
<button onclick="viewExpenses()">View Expenses</button>
<button onclick="deleteExpense()">Delete Expense</button>

<h3>Expenses:</h3>
<ul id="expenseList"></ul>

<script>

let db;

// Open Database
let request = indexedDB.open("ExpenseDB", 1);

request.onupgradeneeded = function(event) {
    db = event.target.result;

    let store = db.createObjectStore("expenses", {
        keyPath: "id",
        autoIncrement: true
    });

    store.createIndex("title", "title", { unique: false });
};

request.onsuccess = function(event) {
    db = event.target.result;
};

request.onerror = function(event) {
    alert("Database error: " + event.target.errorCode);
};

// Add Expense
function addExpense() {

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    let expense = {
        title: document.getElementById("title").value,
        amount: document.getElementById("amount").value,
        date: document.getElementById("date").value
    };

    let request = store.add(expense);

    request.onsuccess = function() {
        alert("Expense Added!");
    };

    request.onerror = function(event) {
        alert("Insert Error: " + event.target.error);
    };
}

// View Expenses
function viewExpenses() {

    let transaction = db.transaction(["expenses"], "readonly");
    let store = transaction.objectStore("expenses");
    let request = store.getAll();

    request.onsuccess = function(event) {

        let data = event.target.result;
        let list = document.getElementById("expenseList");
        list.innerHTML = "";

        data.forEach(function(item) {
            let li = document.createElement("li");
            li.innerText =
                "ID: " + item.id +
                " | " + item.title +
                " | â‚¹" + item.amount +
                " | " + item.date;

            list.appendChild(li);
        });
    };

    request.onerror = function(event) {
        alert("Fetch Error: " + event.target.error);
    };
}

// Delete Expense
function deleteExpense() {

    let id = parseInt(prompt("Enter Expense ID to delete:"));

    let transaction = db.transaction(["expenses"], "readwrite");
    let store = transaction.objectStore("expenses");

    let request = store.delete(id);

    request.onsuccess = function() {
        alert("Expense Deleted!");
        viewExpenses();
    };

    request.onerror = function(event) {
        alert("Delete Error: " + event.target.error);
    };
}

</script>

</body>
</html>
